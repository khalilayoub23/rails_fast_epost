<!DOCTYPE html>
<html lang="<%= I18n.locale %>" dir="<%= text_direction %>" id="html-root">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title><%= content_for(:title) || t("public.meta_title") %></title>
    <meta name="description" content="<%= t("public.meta_description") %>">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tajawal:wght@400;500;600;700&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "material-icons", "data-turbo-track": "reload" %>
    <% if rtl? %>
      <%= stylesheet_link_tag "rtl", "data-turbo-track": "reload" %>
    <% end %>
    <%= javascript_importmap_tags %>
    <script nonce="<%= content_security_policy_nonce %>">
      (function() {
        try {
          var ls = localStorage.getItem('ui.dark');
          var dark = (ls === 'true') || (ls === null && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
          var root = document.documentElement;
          var serverDir = root.getAttribute('dir') || 'ltr';
          var storedDir = localStorage.getItem('ui.direction');
          var dir = storedDir;

          if (!storedDir || storedDir !== serverDir) {
            dir = serverDir;
            localStorage.setItem('ui.direction', serverDir);
          }

          root.classList.toggle('dark', dark);
          root.setAttribute('dir', dir || 'ltr');
        } catch (e) {}
      })();
    </script>
  </head>

  <body class="public-layout">
    <% nav_items = [
      { label: t("nav.services"), path: pages_services_path },
      { label: t("nav.track"), path: pages_track_parcel_path },
      { label: t("nav.contact"), path: pages_contact_path },
      { label: t("nav.law_firms"), path: pages_law_firms_path },
      { label: t("nav.ecommerce"), path: pages_ecommerce_path },
      { label: t("nav.privacy_policy"), path: pages_privacy_policy_path }
    ] %>

    <nav class="landing-nav" dir="<%= text_direction %>" data-testid="landing-nav">
      <div class="container mx-auto px-4">
        <div class="landing-nav__inner">
          <div class="landing-nav__section">
            <%= link_to pages_home_path, class: "landing-nav__brand", aria: { label: "Fast Epost" } do %>
              <%= image_tag "fast_epost_transparent.png", class: "h-12 w-auto", alt: "Fast Epost" %>
            <% end %>
          </div>

          <ul class="landing-nav__menu" role="menubar" data-testid="landing-nav-menu">
            <% nav_items.each do |item| %>
              <% active = current_page?(item[:path]) %>
              <li>
                <%= link_to item[:label], item[:path], class: ["landing-nav__link", (active ? "is-active" : nil)].compact.join(' '), role: "menuitem" %>
              </li>
            <% end %>
          </ul>

          <div class="landing-nav__section">
            <div class="landing-nav__controls">
              <div class="landing-nav__locale">
                <%= render "shared/locale_switcher" %>
              </div>

              <% if user_signed_in? %>
                <%= link_to t("nav.dashboard"), dashboard_path, class: "flex h-10 items-center justify-center rounded-xl border border-white/10 bg-white/5 px-6 text-sm font-bold text-white transition-all hover:bg-white/10 hover:border-white/20" %>
                <%= button_to t("nav.logout"), destroy_user_session_path,
                      method: :delete,
                      form: { class: "inline" },
                      class: "flex h-10 items-center justify-center rounded-xl bg-yellow-400 px-6 text-sm font-bold text-black transition-all hover:bg-yellow-300 shadow-lg shadow-yellow-400/20",
                      data: { turbo: false } %>
              <% else %>
                <% if controller_name == 'sessions' && (action_name == 'new' || action_name == 'create') %>
                  <%= link_to t("nav.signup", default: "Sign Up"), new_user_registration_path, class: "flex h-10 items-center justify-center rounded-xl bg-yellow-400 px-6 text-sm font-bold text-black transition-all hover:bg-yellow-300 shadow-lg shadow-yellow-400/20", data: { turbo: false } %>
                <% else %>
                  <%= link_to t("nav.login", default: "Login"), new_user_session_path, class: "flex h-10 items-center justify-center rounded-xl bg-yellow-400 px-6 text-sm font-bold text-black transition-all hover:bg-yellow-300 shadow-lg shadow-yellow-400/20", data: { turbo: false } %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-20 md:pt-24">
      <div class="container mx-auto px-4">
        <%= render "shared/flash" %>
      </div>
      <%= yield %>
    </main>

    <%= render "shared/footer" %>
    <%= render "shared/cookie_consent" %>

    <!-- Navigation Interactions -->
    <script nonce="<%= content_security_policy_nonce %>">
      (function() {
        function initLandingNav() {
          var nav = document.querySelector('.landing-nav');
          if (!nav) { return; }

          function setShadow() {
            nav.classList.toggle('is-scrolled', window.scrollY > 10);
          }

          setShadow();
          window.addEventListener('scroll', setShadow, { passive: true });
        }

        document.addEventListener('turbo:load', initLandingNav);

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initLandingNav);
        } else {
          initLandingNav();
        }
      })();
    </script>
  </body>
</html>
