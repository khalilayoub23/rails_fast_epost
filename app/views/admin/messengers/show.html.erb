<%# app/views/admin/messengers/show.html.erb %>
<div class="flex items-start justify-between gap-4 mb-6">
  <div>
    <h1 class="text-2xl font-bold text-white"><%= @messenger.display_name %></h1>
    <p class="mt-1 text-sm text-slate-400">Messenger profile, status, and recent work.</p>
  </div>

  <div class="flex items-center gap-2">
    <%= link_to "Edit", edit_admin_messenger_path(@messenger), class: "inline-flex items-center rounded-xl bg-white/10 px-4 py-2 text-sm font-semibold text-white hover:bg-white/15" %>
    <%= link_to "Back", admin_messengers_path, class: "inline-flex items-center rounded-xl bg-white/10 px-4 py-2 text-sm font-semibold text-white hover:bg-white/15" %>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
  <div class="rounded-2xl border border-white/10 bg-white/5 p-6 shadow-xl shadow-black/30 backdrop-blur">
    <h2 class="font-semibold text-lg text-white mb-4">Messenger Details</h2>
    <dl class="divide-y divide-white/10">
      <% status_badge = @messenger.available? ? "bg-emerald-500/15 text-emerald-200" : @messenger.busy? ? "bg-yellow-500/15 text-yellow-200" : "bg-white/10 text-slate-200" %>
      <div class="py-3">
        <dt class="text-sm font-semibold text-slate-300">Status</dt>
        <dd class="mt-2">
          <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold <%= status_badge %>"><%= @messenger.status.titleize %></span>
        </dd>
      </div>
      <div class="py-3">
        <dt class="text-sm font-semibold text-slate-300">Email</dt>
        <dd class="mt-1 text-sm text-slate-200"><%= @messenger.email %></dd>
      </div>
      <div class="py-3">
        <dt class="text-sm font-semibold text-slate-300">Phone</dt>
        <dd class="mt-1 text-sm text-slate-200"><%= @messenger.phone %></dd>
      </div>
      <div class="py-3">
        <dt class="text-sm font-semibold text-slate-300">Carrier</dt>
        <dd class="mt-1 text-sm text-slate-200"><%= @messenger.carrier&.name || "Independent" %></dd>
      </div>
      <div class="py-3">
        <dt class="text-sm font-semibold text-slate-300">Vehicle Type</dt>
        <dd class="mt-1 text-sm text-slate-200"><%= @messenger.vehicle_type&.titleize %></dd>
      </div>
      <% if @messenger.license_plate.present? %>
        <div class="py-3">
          <dt class="text-sm font-semibold text-slate-300">License Plate</dt>
          <dd class="mt-1 text-sm text-slate-200"><%= @messenger.license_plate %></dd>
        </div>
      <% end %>
      <div class="py-3">
        <dt class="text-sm font-semibold text-slate-300">Employee ID</dt>
        <dd class="mt-1 text-sm text-slate-200"><%= @messenger.employee_id %></dd>
      </div>
      <% if @messenger.notes.present? %>
        <div class="py-3">
          <dt class="text-sm font-semibold text-slate-300">Notes</dt>
          <dd class="mt-1 text-sm text-slate-200"><%= @messenger.notes %></dd>
        </div>
      <% end %>
    </dl>

    <div class="mt-5 flex flex-wrap gap-2">
      <%= button_to "Mark Available", update_status_admin_messenger_path(@messenger, status: "available"), method: :patch,
                    class: "inline-flex items-center rounded-xl bg-emerald-500/15 px-4 py-2 text-sm font-semibold text-emerald-200 hover:bg-emerald-500/20" %>
      <%= button_to "Mark Busy", update_status_admin_messenger_path(@messenger, status: "busy"), method: :patch,
                    class: "inline-flex items-center rounded-xl bg-yellow-500/15 px-4 py-2 text-sm font-semibold text-yellow-200 hover:bg-yellow-500/20" %>
      <%= button_to "Mark Offline", update_status_admin_messenger_path(@messenger, status: "offline"), method: :patch,
                    class: "inline-flex items-center rounded-xl bg-white/10 px-4 py-2 text-sm font-semibold text-white hover:bg-white/15" %>
    </div>
  </div>

  <div class="rounded-2xl border border-white/10 bg-white/5 p-6 shadow-xl shadow-black/30 backdrop-blur">
    <h2 class="font-semibold text-lg text-white mb-4">Performance</h2>
    <div class="grid grid-cols-2 gap-4">
      <div class="rounded-xl border border-white/10 bg-white/5 p-4">
        <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-300">Total Deliveries</h3>
        <p class="mt-2 text-2xl font-bold text-white"><%= @messenger.total_deliveries %></p>
      </div>
      <div class="rounded-xl border border-white/10 bg-white/5 p-4">
        <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-300">On-Time Rate</h3>
        <p class="mt-2 text-2xl font-bold text-emerald-200"><%= number_to_percentage(@messenger.on_time_rate * 100, precision: 1) %></p>
      </div>
      <div class="rounded-xl border border-white/10 bg-white/5 p-4">
        <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-300">Today's Tasks</h3>
        <p class="mt-2 text-2xl font-bold text-white"><%= @today_tasks.count %></p>
      </div>
      <div class="rounded-xl border border-white/10 bg-white/5 p-4">
        <h3 class="text-xs font-semibold uppercase tracking-wide text-slate-300">Active Tasks</h3>
        <p class="mt-2 text-2xl font-bold text-yellow-200"><%= @task_stats[:in_transit] %></p>
      </div>
    </div>
  </div>

  <div class="rounded-2xl border border-white/10 bg-white/5 p-6 shadow-xl shadow-black/30 backdrop-blur">
    <h2 class="font-semibold text-lg text-white mb-4">Task Overview</h2>
    <ul class="space-y-2 text-sm text-slate-200">
      <li class="flex items-center justify-between"><span>Total Tasks</span><span class="font-semibold text-white"><%= @task_stats[:total] %></span></li>
      <li class="flex items-center justify-between"><span>Pending</span><span class="font-semibold text-white"><%= @task_stats[:pending] %></span></li>
      <li class="flex items-center justify-between"><span>In Transit</span><span class="font-semibold text-white"><%= @task_stats[:in_transit] %></span></li>
      <li class="flex items-center justify-between"><span>Delivered</span><span class="font-semibold text-white"><%= @task_stats[:delivered] %></span></li>
    </ul>

    <% if @messenger.current_location.present? %>
      <div class="mt-5 rounded-xl border border-white/10 bg-white/5 p-4">
        <h3 class="text-sm font-semibold text-white mb-2">Current Location</h3>
        <p class="text-sm text-slate-200">
          Lat: <%= @messenger.current_location["latitude"] %><br>
          Lng: <%= @messenger.current_location["longitude"] %>
        </p>
      </div>
    <% end %>
  </div>
</div>

<div class="rounded-2xl border border-white/10 bg-white/5 shadow-xl shadow-black/30 backdrop-blur overflow-hidden">
  <div class="px-6 py-4 border-b border-white/10">
    <h2 class="font-semibold text-lg text-white">Recent Tasks</h2>
  </div>
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-white/10">
      <thead class="bg-white/5">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-300">Barcode</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-300">Status</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-300">Customer</th>
          <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-300">Created</th>
          <th class="px-4 py-3 text-right text-xs font-semibold uppercase tracking-wide text-slate-300">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-white/10">
        <% @recent_tasks.each do |task| %>
          <tr class="hover:bg-white/5">
            <td class="px-4 py-3 text-sm font-mono text-slate-200"><%= task.barcode %></td>
            <td class="px-4 py-3 text-sm text-slate-200">
              <span class="inline-flex items-center rounded-full bg-white/10 px-2.5 py-1 text-xs font-semibold text-slate-200"><%= task.status.titleize %></span>
            </td>
            <td class="px-4 py-3 text-sm text-slate-200"><%= task.customer.name %></td>
            <td class="px-4 py-3 text-sm text-slate-200"><%= task.created_at.strftime("%Y-%m-%d") %></td>
            <td class="px-4 py-3 text-right text-sm">
              <%= link_to "View", task_path(task), class: "inline-flex items-center rounded-lg bg-white/10 px-3 py-1.5 text-xs font-semibold text-white hover:bg-white/15" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<div class="mt-6 rounded-2xl border border-white/10 bg-white/5 p-6 shadow-xl shadow-black/30 backdrop-blur">
  <%= render "notification_preferences/index", parent: @messenger, collection: @messenger.notification_preferences, new_path: new_messenger_notification_preference_path(@messenger) %>
</div>
