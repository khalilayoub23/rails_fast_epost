<%# app/views/admin/messengers/index.html.erb %>
<div class="page-header flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold">Messengers</h1>
  <%= link_to 'New Messenger', new_admin_messenger_path, class: 'btn btn-primary' %>
</div>

<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
  <div class="bg-white rounded shadow p-4">
    <h3 class="text-sm font-semibold text-gray-600">Total Messengers</h3>
    <p class="text-2xl font-bold"><%= @stats[:total] %></p>
  </div>
  <div class="bg-green-100 rounded shadow p-4">
    <h3 class="text-sm font-semibold text-green-800">Available</h3>
    <p class="text-2xl font-bold text-green-600"><%= @stats[:available] %></p>
  </div>
  <div class="bg-yellow-100 rounded shadow p-4">
    <h3 class="text-sm font-semibold text-yellow-800">Busy</h3>
    <p class="text-2xl font-bold text-yellow-600"><%= @stats[:busy] %></p>
  </div>
  <div class="bg-gray-100 rounded shadow p-4">
    <h3 class="text-sm font-semibold text-gray-800">Offline</h3>
    <p class="text-2xl font-bold text-gray-600"><%= @stats[:offline] %></p>
  </div>
</div>

<div class="mb-4">
  <%= form_with url: admin_messengers_path, method: :get, local: true, class: 'flex gap-2 flex-wrap' do |f| %>
    <%= f.text_field :search, value: params[:search], placeholder: 'Name, email, employee ID...', class: 'input input-bordered' %>
    <%= f.select :status, Messenger.statuses.map { |k, v| [k.titleize, k] }, { include_blank: 'All Statuses' }, class: 'input input-bordered' %>
    <%= f.select :vehicle_type, Messenger.vehicle_types.map { |k, v| [k.titleize, k] }, { include_blank: 'All Vehicles' }, class: 'input input-bordered' %>
    <%= f.select :carrier_id, Carrier.pluck(:name, :id), { include_blank: 'All Carriers' }, class: 'input input-bordered' %>
    <%= f.submit 'Filter', class: 'btn btn-secondary' %>
  <% end %>
</div>

<table class="table-auto w-full bg-white rounded shadow">
  <thead>
    <tr>
      <th class="px-4 py-2">Name</th>
      <th class="px-4 py-2">Status</th>
      <th class="px-4 py-2">Vehicle</th>
      <th class="px-4 py-2">Carrier</th>
      <th class="px-4 py-2">Employee ID</th>
      <th class="px-4 py-2">Deliveries</th>
      <th class="px-4 py-2">On-Time Rate</th>
      <th class="px-4 py-2">Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @messengers.each do |messenger| %>
      <tr>
        <td class="border px-4 py-2 font-semibold">
          <%= link_to messenger.display_name, admin_messenger_path(messenger), class: 'text-blue-700 hover:underline' %>
        </td>
        <td class="border px-4 py-2">
          <% status_color = messenger.available? ? 'badge-success' : messenger.busy? ? 'badge-warning' : 'badge-secondary' %>
          <span class="badge <%= status_color %>"><%= messenger.status.titleize %></span>
        </td>
        <td class="border px-4 py-2"><%= messenger.vehicle_type&.titleize %></td>
        <td class="border px-4 py-2"><%= messenger.carrier&.name %></td>
        <td class="border px-4 py-2"><%= messenger.employee_id %></td>
        <td class="border px-4 py-2"><%= messenger.total_deliveries %></td>
        <td class="border px-4 py-2"><%= number_to_percentage(messenger.on_time_rate * 100, precision: 1) %></td>
        <td class="border px-4 py-2">
          <%= link_to 'View', admin_messenger_path(messenger), class: 'btn btn-xs btn-outline' %>
          <%= link_to 'Edit', edit_admin_messenger_path(messenger), class: 'btn btn-xs btn-outline' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
