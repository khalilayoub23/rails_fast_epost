<%# app/views/admin/senders/show.html.erb %>
<div class="page-header flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold"><%= @sender.display_name %></h1>
  <div>
    <%= link_to 'Edit', edit_admin_sender_path(@sender), class: 'btn btn-secondary' %>
    <%= link_to 'Back', admin_senders_path, class: 'btn btn-outline ml-2' %>
  </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
  <div class="bg-white rounded shadow p-6">
    <h2 class="font-semibold text-lg mb-2">Sender Details</h2>
    <dl class="divide-y">
      <dt class="font-medium">Type</dt>
      <dd class="mb-2"><span class="badge badge-info"><%= @sender.sender_type.titleize %></span></dd>
      <dt class="font-medium">Email</dt>
      <dd class="mb-2"><%= @sender.email %></dd>
      <dt class="font-medium">Phone</dt>
      <dd class="mb-2"><%= @sender.phone %></dd>
      <% if @sender.company_name.present? %>
        <dt class="font-medium">Company</dt>
        <dd class="mb-2"><%= @sender.company_name %></dd>
      <% end %>
      <% if @sender.tax_id.present? %>
        <dt class="font-medium">Tax ID</dt>
        <dd class="mb-2"><%= @sender.tax_id %></dd>
      <% end %>
      <% if @sender.business_registration.present? %>
        <dt class="font-medium">Business Registration</dt>
        <dd class="mb-2"><%= @sender.business_registration %></dd>
      <% end %>
      <dt class="font-medium">Address</dt>
      <dd class="mb-2"><%= @sender.address %></dd>
      <% if @sender.notes.present? %>
        <dt class="font-medium">Notes</dt>
        <dd class="mb-2"><%= @sender.notes %></dd>
      <% end %>
    </dl>
  </div>
  <div class="bg-white rounded shadow p-6">
    <h2 class="font-semibold text-lg mb-2">Task Stats</h2>
    <ul class="mb-4">
      <li>Total Tasks: <span class="font-bold"><%= @task_stats[:total] %></span></li>
      <li>Pending: <span class="font-bold"><%= @task_stats[:pending] %></span></li>
      <li>In Transit: <span class="font-bold"><%= @task_stats[:in_transit] %></span></li>
      <li>Delivered: <span class="font-bold"><%= @task_stats[:delivered] %></span></li>
    </ul>
    <h3 class="font-semibold mb-2">Recent Tasks</h3>
    <ul>
      <% @recent_tasks.each do |task| %>
        <li>
          <%= link_to task.barcode, task_path(task), class: 'text-blue-700 hover:underline' %>
          <span class="ml-2 text-xs text-gray-500">(<%= task.status.titleize %>)</span>
        </li>
      <% end %>
    </ul>
  </div>

  <div class="bg-white rounded shadow p-6">
    <h2 class="font-semibold text-lg mb-2">Carrier Experience</h2>
    <% if @carrier_performance.present? %>
      <div class="mb-4">
        <div class="text-sm text-gray-500">Average Carrier Score</div>
        <div class="text-3xl font-bold text-dark"><%= display_rating(@sender_average_carrier_score) %></div>
      </div>
      <table class="table-auto w-full">
        <thead>
          <tr>
            <th class="px-2 py-1 text-left">Carrier</th>
            <th class="px-2 py-1 text-left">Overall</th>
            <th class="px-2 py-1 text-left">Sender</th>
            <th class="px-2 py-1 text-left">Recipient</th>
            <th class="px-2 py-1 text-left">Completion</th>
            <th class="px-2 py-1 text-left">Delivered</th>
          </tr>
        </thead>
        <tbody>
          <% @carrier_performance.each do |carrier| %>
            <tr>
              <td class="px-2 py-1 font-medium"><%= link_to carrier.name, carrier_path(carrier), class: 'text-blue-700 hover:underline' %></td>
              <% summary = carrier.rating_summary %>
              <td class="px-2 py-1"><%= display_rating(summary[:average_overall_rating]) %></td>
              <td class="px-2 py-1"><%= display_rating(summary[:average_sender_rating]) %></td>
              <td class="px-2 py-1"><%= display_rating(summary[:average_recipient_rating]) %></td>
              <td class="px-2 py-1"><%= display_rating(summary[:average_completion_rating]) %></td>
              <td class="px-2 py-1"><%= @carrier_delivery_counts[carrier.id] || 0 %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-body">No carrier performance data yet.</p>
    <% end %>
  </div>
</div>

<div class="bg-white rounded shadow p-6 mt-6">
  <%= render "notification_preferences/index", parent: @sender, collection: @sender.notification_preferences, new_path: new_sender_notification_preference_path(@sender) %>
</div>
