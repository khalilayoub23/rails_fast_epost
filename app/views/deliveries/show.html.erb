<div class="space-y-6">
  <div class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
    <div>
      <p class="text-sm uppercase tracking-wide text-gray-400"><%= t("deliveries.show.subtitle") %></p>
      <h1 class="text-3xl font-semibold text-white"><%= t("deliveries.show.title", case_number: @delivery.case_number) %></h1>
      <p class="text-sm text-gray-400"><%= t("deliveries.show.description") %></p>
    </div>
    <div class="flex flex-wrap gap-3">
      <%= link_to t("deliveries.back", default: "Back"), deliveries_path,
        class: "inline-flex items-center rounded-xl border border-gray-600 px-4 py-2 text-sm font-medium text-gray-300 hover:border-yellow-400 hover:text-yellow-300" %>
      <% if policy(@delivery).update? %>
        <%= link_to t("deliveries.edit", default: "Edit"), edit_delivery_path(@delivery),
          class: "inline-flex items-center rounded-xl border border-yellow-400/60 bg-yellow-400/10 px-4 py-2 text-sm font-medium text-yellow-300 shadow-lg hover:bg-yellow-400/20" %>
      <% end %>
      <% if policy(@delivery).destroy? %>
        <%= button_to t("deliveries.delete", default: "Remove"), @delivery,
          method: :delete,
          data: { turbo_confirm: t("deliveries.confirm_delete", default: "Are you sure?"), turbo_frame: "_top" },
          class: "inline-flex items-center rounded-xl border border-red-500/40 bg-red-500/10 px-4 py-2 text-sm font-medium text-red-200 hover:bg-red-500/20" %>
      <% end %>
    </div>
  </div>

  <div class="grid gap-6 xl:grid-cols-3">
    <div class="xl:col-span-2 space-y-6">
      <%= turbo_frame_tag dom_id(@delivery, :progress) do %>
        <%= render "progress", delivery: @delivery %>
      <% end %>

      <%= turbo_frame_tag dom_id(@delivery, :timeline) do %>
        <%= render "timeline", delivery: @delivery %>
      <% end %>
    </div>
    <div class="space-y-6">
      <% Delivery::SIGNATURE_ROLES.each do |role| %>
        <%= render "signature_card", delivery: @delivery, role: role %>
      <% end %>
    </div>
  </div>

  <div class="grid gap-6 md:grid-cols-2">
    <div class="rounded-2xl border border-gray-700 bg-gray-900/40 p-6 shadow-xl">
      <h2 class="text-xl font-semibold text-white"><%= t("deliveries.show.participants_title") %></h2>
      <dl class="mt-4 space-y-4 text-sm text-gray-300">
        <div class="flex items-start justify-between">
          <dt class="text-gray-400"><%= t("deliveries.show.sender") %></dt>
          <dd class="text-right">
            <p class="font-semibold text-white"><%= @delivery.sender&.full_name %></p>
            <p class="text-xs text-gray-500"><%= @delivery.sender&.email %></p>
          </dd>
        </div>
        <div class="flex items-start justify-between">
          <dt class="text-gray-400"><%= t("deliveries.show.courier") %></dt>
          <dd class="text-right">
            <p class="font-semibold text-white"><%= @delivery.courier&.full_name %></p>
            <p class="text-xs text-gray-500"><%= @delivery.courier&.email %></p>
          </dd>
        </div>
        <div class="flex items-start justify-between">
          <dt class="text-gray-400"><%= t("deliveries.show.recipient") %></dt>
          <dd class="text-right">
            <p class="font-semibold text-white"><%= @delivery.recipient&.full_name %></p>
            <p class="text-xs text-gray-500"><%= @delivery.recipient&.email %></p>
          </dd>
        </div>
      </dl>
      <div class="mt-6 rounded-xl border border-dashed border-gray-600 px-4 py-3 text-xs text-gray-400">
        <p class="font-semibold text-gray-200"><%= t("deliveries.show.notes") %></p>
        <p><%= @delivery.notes.presence || t("deliveries.show.no_notes") %></p>
      </div>
    </div>

    <div class="rounded-2xl border border-gray-700 bg-gray-900/40 p-6 shadow-xl">
      <h2 class="text-xl font-semibold text-white"><%= t("deliveries.show.documents") %></h2>
      <ul class="mt-4 space-y-4 text-sm">
        <% {
          t("deliveries.show.docs.original") => @delivery.original_court_pdf,
          t("deliveries.show.docs.base") => @delivery.base_pdf,
          t("deliveries.show.docs.current") => @delivery.current_pdf,
          t("deliveries.show.docs.final") => @delivery.final_pdf
        }.each do |label, blob| %>
          <li class="flex items-center justify-between rounded-xl border border-gray-800/80 bg-gray-800/40 px-4 py-3">
            <div>
              <p class="text-gray-300"><%= label %></p>
              <% if blob&.attached? %>
                <% attached_at = blob.attachment&.created_at %>
                <p class="text-xs text-gray-500">Updated <%= attached_at ? l(attached_at, format: :short) : "Recently" %></p>
              <% else %>
                <p class="text-xs text-gray-500">Awaiting generation</p>
              <% end %>
            </div>
            <% if blob&.attached? %>
              <%= link_to "Download", rails_blob_path(blob, disposition: "attachment"),
                class: "rounded-lg border border-yellow-400/40 px-3 py-1 text-xs font-semibold text-yellow-300 hover:bg-yellow-400/10",
                target: "_blank", rel: "noopener" %>
            <% else %>
              <span class="text-xs text-gray-500">-</span>
            <% end %>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
</div>
