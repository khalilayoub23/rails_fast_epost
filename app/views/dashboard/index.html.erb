<div data-controller="dashboard-editor" data-dashboard-editor-save-url-value="<%= admin_dashboard_layout_path %>">
  <% toolbar_label_class = "text-xs text-body dark:text-bodydark mr-2" %>
  <% toolbar_select_class = "rounded border border-stroke bg-transparent px-2 py-1 text-xs text-black outline-none transition focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary" %>
  <% card_class = "rounded-2xl border border-stroke bg-white shadow-2xl dark:border-strokedark dark:bg-boxdark" %>
  <!-- Dashboard Header with Dark Theme -->
  <div class="mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h2 class="text-3xl font-bold text-dark dark:text-white mb-2">
        <%= t('dashboard_title', default: 'Dashboard') %>
      </h2>
      <p class="text-body dark:text-bodydark text-sm">
        <%= t('dashboard_subtitle', default: 'Welcome back! Here\'s what\'s happening today.') %>
      </p>
    </div>
    
    <button class="inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-gray-900 hover:bg-opacity-90"
            data-action="click->dashboard-editor#toggleEdit">
      <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
      </svg>
      <%= t('edit_layout', default: 'Edit Layout') %>
    </button>
  </div>

  <%= turbo_stream_from "dashboard" %>

<div class="grid grid-cols-12 gap-4 md:gap-6 2xl:gap-7.5"
     data-dashboard-editor-target="container">
  <% layout = JSON.parse(File.read(Rails.root.join('config','dashboard_layout.json'))) rescue [] %>
  <% layout.each do |w| %>
    <% id = w["id"]; span = w["span"] %>
    <% if id == "kpis" %>
      <div data-widget-id="kpis" data-span="<%= span || 'col-span-12' %>" class="<%= span || 'col-span-12' %>" title="Drag to reorder">
        <div data-role="widget-toolbar" class="mb-2 hidden">
          <label class="<%= toolbar_label_class %>">Width:</label>
          <select class="<%= toolbar_select_class %>" data-action="change->dashboard-editor#changeSpan">
            <option value="col-span-12">Full</option>
            <option value="col-span-12 xl:col-span-6">Half (xl)</option>
          </select>
        </div>
        <%= render "kpis" %>
      </div>
    <% elsif id == "chart" %>
      <!-- Monthly Sales Chart - Dark Theme -->
      <div data-widget-id="chart" data-span="<%= span %>" class="<%= span %> <%= card_class %> px-5 pb-5 pt-7.5 sm:px-7.5">
        <div data-role="widget-toolbar" class="mb-2 hidden">
          <label class="<%= toolbar_label_class %>">Width:</label>
          <select class="<%= toolbar_select_class %>" data-action="change->dashboard-editor#changeSpan">
            <option value="col-span-12" <%= 'selected' if span == 'col-span-12' %>>Full</option>
            <option value="col-span-12 xl:col-span-8" <%= 'selected' if span == 'col-span-12 xl:col-span-8' %>>2/3 (xl)</option>
            <option value="col-span-12 xl:col-span-6" <%= 'selected' if span == 'col-span-12 xl:col-span-6' %>>Half (xl)</option>
          </select>
        </div>
    <div class="flex flex-wrap items-start justify-between gap-3 sm:flex-nowrap">
      <div class="flex w-full flex-wrap gap-3 sm:gap-5">
        <div class="flex min-w-47.5">
          <span class="mr-2 mt-1 flex h-4 w-full max-w-4 items-center justify-center rounded-full border border-yellow-400">
            <span class="block h-2.5 w-full max-w-2.5 rounded-full bg-yellow-400"></span>
          </span>
          <div class="w-full">
            <p class="font-semibold text-yellow-400">Total Revenue</p>
            <p class="text-sm font-medium text-gray-400">12.04.2022 - 12.05.2022</p>
          </div>
        </div>
        <div class="flex min-w-47.5">
          <span class="mr-2 mt-1 flex h-4 w-full max-w-4 items-center justify-center rounded-full border border-blue-400">
            <span class="block h-2.5 w-full max-w-2.5 rounded-full bg-blue-400"></span>
          </span>
          <div class="w-full">
            <p class="font-semibold text-blue-400">Total Sales</p>
            <p class="text-sm font-medium text-gray-400">12.04.2022 - 12.05.2022</p>
          </div>
        </div>
      </div>
      <div class="flex w-full max-w-45 justify-end">
        <div class="inline-flex items-center rounded-lg bg-gray-900/50 p-1.5">
          <button class="rounded bg-yellow-400 px-3 py-1 text-xs font-medium text-gray-900 shadow-lg hover:bg-yellow-500 transition-colors">
            Day
          </button>
          <button class="px-3 py-1 text-xs font-medium text-gray-400 hover:bg-gray-800 hover:text-white rounded transition-colors">
            Week
          </button>
          <button class="px-3 py-1 text-xs font-medium text-gray-400 hover:bg-gray-800 hover:text-white rounded transition-colors">
            Month
          </button>
        </div>
      </div>
    </div>

    <div>
      <div id="chartOne" class="-ml-5" data-controller="charts" data-charts-series-a-value='[120,380,220,180,260,140,80,300,190,280,220,110]' data-charts-series-b-value='[100,320,200,150,210,120,60,260,160,250,190,90]'></div>
    </div>
      </div>
    <% elsif id == "target" %>
      <!-- Monthly Target - Dark Theme -->
      <div data-widget-id="target" data-span="<%= span %>" class="<%= span %> <%= card_class %> p-7.5">
        <div data-role="widget-toolbar" class="mb-2 hidden">
          <label class="<%= toolbar_label_class %>">Width:</label>
          <select class="<%= toolbar_select_class %>" data-action="change->dashboard-editor#changeSpan">
            <option value="col-span-12" <%= 'selected' if span == 'col-span-12' %>>Full</option>
            <option value="col-span-12 xl:col-span-4" <%= 'selected' if span == 'col-span-12 xl:col-span-4' %>>1/3 (xl)</option>
            <option value="col-span-12 xl:col-span-6" <%= 'selected' if span == 'col-span-12 xl:col-span-6' %>>Half (xl)</option>
          </select>
        </div>
    <div class="mb-4 justify-between gap-4 sm:flex">
      <div>
        <h5 class="text-xl font-semibold text-dark dark:text-white">
          Monthly Target
        </h5>
      </div>
      <div class="relative z-20 inline-block">
        <select name="" id="" class="relative z-20 inline-flex appearance-none rounded-lg border border-stroke bg-transparent py-1 pl-3 pr-8 text-sm font-medium text-black outline-none transition focus:border-primary dark:border-form-strokedark dark:bg-form-input dark:text-white dark:focus:border-primary">
          <option value="">This Month</option>
          <option value="">Last Month</option>
        </select>
        <span class="absolute right-3 top-1/2 z-10 -translate-y-1/2">
          <svg width="10" height="6" viewBox="0 0 10 6" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M0.47072 1.08816C0.47072 1.02932 0.500141 0.955772 0.54404 0.911882C0.551987 0.903934 0.551987 0.903934 0.559934 0.895887L0.667063 0.789758C0.711953 0.744868 0.785499 0.715446 0.844341 0.715446C0.903183 0.715446 0.976729 0.744868 1.02162 0.789758L5.00007 4.56497L8.97852 0.789758C9.02341 0.744868 9.09696 0.715446 9.1558 0.715446C9.21464 0.715446 9.28819 0.744868 9.33308 0.789758L9.44021 0.895887C9.44816 0.903934 9.44816 0.903934 9.45611 0.911882C9.50001 0.955772 9.52943 1.02932 9.52943 1.08816C9.52943 1.147 9.50001 1.22055 9.45611 1.26444L5.2308 5.36379C5.1859 5.40868 5.11235 5.4381 5.05351 5.4381C4.99467 5.4381 4.92112 5.40868 4.87623 5.36379L0.650904 1.26444C0.607014 1.22055 0.57759 1.147 0.57759 1.08816C0.57759 1.08816 0.552669 1.11308 0.47072 1.08816Z" fill="#9CA3AF"/>
          </svg>
        </span>
      </div>
    </div>

    <div class="mb-2">
      <p class="font-medium text-gray-400">Target you've set for each month</p>
    </div>

    <div class="mx-auto flex justify-center relative">
      <svg class="rotate-90 transform" width="200" height="200">
        <circle cx="100" cy="100" r="80" stroke="#374151" stroke-width="16" fill="transparent"/>
        <circle cx="100" cy="100" r="80" stroke="#FBBF24" stroke-width="16" fill="transparent" stroke-dasharray="377" stroke-dashoffset="94.25" stroke-linecap="round"/>
      </svg>
      <div class="absolute flex flex-col items-center justify-center">
        <span class="text-3xl font-bold text-dark dark:text-white">75.55%</span>
        <span class="text-sm font-medium text-green-400">+10%</span>
      </div>
    </div>

    <div class="mt-7">
      <p class="mb-3 font-medium text-dark dark:text-white">
        You earn $<%= number_with_delimiter(((@revenue_total_cents || 0) / 100.0).to_i) %> today, it's higher than last month.
      </p>
      <p class="text-sm text-body dark:text-bodydark">Keep up your good work!</p>
    </div>

    <div class="mt-5 flex items-center justify-between border-t border-stroke pt-5 dark:border-strokedark">
      <div>
        <p class="font-medium text-gray-400 text-sm">Target</p>
        <p class="text-xl font-bold text-yellow-400">$20K</p>
      </div>
      <div>
        <p class="font-medium text-gray-400 text-sm">Revenue</p>
        <p class="text-xl font-bold text-green-400">$20K</p>
      </div>
      <div>
        <p class="font-medium text-gray-400 text-sm">Today</p>
        <p class="text-xl font-bold text-green-400">$20K</p>
      </div>
    </div>
      </div>
    <% elsif id == "recent_payments" %>
      <!-- Recent Payments - Dark Theme -->
      <div data-widget-id="recent_payments" data-span="<%= span %>" class="<%= span %> <%= card_class %> px-5 pt-6 pb-2.5 sm:px-7.5">
        <div data-role="widget-toolbar" class="mb-2 hidden">
          <label class="<%= toolbar_label_class %>">Width:</label>
          <select class="<%= toolbar_select_class %>" data-action="change->dashboard-editor#changeSpan">
            <option value="col-span-12" <%= 'selected' if span == 'col-span-12' %>>Full</option>
            <option value="col-span-12 xl:col-span-7" <%= 'selected' if span == 'col-span-12 xl:col-span-7' %>>7/12 (xl)</option>
            <option value="col-span-12 xl:col-span-6" <%= 'selected' if span == 'col-span-12 xl:col-span-6' %>>Half (xl)</option>
          </select>
        </div>
    <div class="mb-6 flex items-center justify-between">
      <h3 class="text-title-md font-semibold text-dark dark:text-white">Recent Payments</h3>
      <%= link_to "View all", payments_path, class: "text-sm font-medium text-primary hover:opacity-80 transition-opacity" %>
    </div>
    <div class="max-w-full overflow-x-auto">
      <table class="w-full table-auto">
        <thead>
          <tr class="bg-gray-2 text-left dark:bg-meta-4">
            <th class="px-4 py-4 font-medium text-dark dark:text-white">ID</th>
            <th class="px-4 py-4 font-medium text-dark dark:text-white">Provider</th>
            <th class="px-4 py-4 font-medium text-dark dark:text-white">Status</th>
            <th class="px-4 py-4 font-medium text-dark dark:text-white">Amount</th>
            <th class="px-4 py-4 font-medium text-dark dark:text-white">Currency</th>
            <th class="px-4 py-4 text-right font-medium text-dark dark:text-white">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @recent_payments.each do |payment| %>
            <%= render "payments/payment", payment: payment %>
          <% end %>
        </tbody>
      </table>
    </div>
      </div>
    <% elsif id == "recent_tasks" %>
      <!-- Recent Tasks - Dark Theme -->
      <div data-widget-id="recent_tasks" data-span="<%= span %>" class="<%= span %> <%= card_class %> px-5 pt-6 pb-2.5 sm:px-7.5">
        <div data-role="widget-toolbar" class="mb-2 hidden">
          <label class="<%= toolbar_label_class %>">Width:</label>
          <select class="<%= toolbar_select_class %>" data-action="change->dashboard-editor#changeSpan">
            <option value="col-span-12" <%= 'selected' if span == 'col-span-12' %>>Full</option>
            <option value="col-span-12 xl:col-span-5" <%= 'selected' if span == 'col-span-12 xl:col-span-5' %>>5/12 (xl)</option>
            <option value="col-span-12 xl:col-span-6" <%= 'selected' if span == 'col-span-12 xl:col-span-6' %>>Half (xl)</option>
          </select>
        </div>
    <div class="mb-6 flex items-center justify-between">
      <h3 class="text-title-md font-semibold text-dark dark:text-white">Recent Tasks</h3>
      <%= link_to "View all", tasks_path, class: "text-sm font-medium text-primary hover:opacity-80 transition-opacity" %>
    </div>
    <div class="max-w-full overflow-x-auto">
      <table class="w-full table-auto">
        <thead>
          <tr class="bg-gray-2 text-left dark:bg-meta-4">
            <th class="px-4 py-4 font-medium text-dark dark:text-white">Task</th>
            <th class="px-4 py-4 font-medium text-dark dark:text-white">Customer</th>
            <th class="px-4 py-4 font-medium text-dark dark:text-white">Priority</th>
            <th class="px-4 py-4 font-medium text-dark dark:text-white">Status</th>
            <th class="px-4 py-4 text-right font-medium text-dark dark:text-white">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @recent_tasks.each do |task| %>
            <tr class="border-b border-stroke hover:bg-whiten dark:border-strokedark dark:hover:bg-meta-4 transition-colors">
              <td class="px-4 py-4 text-sm font-medium text-dark dark:text-white">
                <%= link_to task_path(task), class: "text-primary hover:opacity-80 transition-opacity" do %>
                  <%= task.title.presence || "Task ##{task.id}" %>
                <% end %>
              </td>
              <td class="px-4 py-4 text-sm text-gray-400"><%= task.customer&.name || "-" %></td>
              <td class="px-4 py-4">
                <%= render "shared/priority_badge", priority: task.priority %>
              </td>
              <td class="px-4 py-4">
                <%= render "shared/status_badge", status: task.status %>
              </td>
              <td class="px-4 py-4 text-right">
                <%= link_to "View", task_path(task), class: "inline-flex items-center rounded border border-stroke bg-white px-3 py-1 text-sm font-medium text-dark hover:bg-whiter dark:border-strokedark dark:bg-boxdark dark:text-white dark:hover:bg-meta-4" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
      </div>
    <% end %>
  <% end %>
</div>
</div>
