<!-- Payment Page -->
<section class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white py-20">
  <% if stripe_publishable_key.present? %>
    <% content_for :head do %>
      <meta name="stripe-publishable-key" content="<%= stripe_publishable_key %>">
    <% end %>
    <div class="sr-only" data-testid="stripe-publishable-key" data-stripe-publishable-key="<%= stripe_publishable_key %>"></div>
  <% end %>
  <div class="container mx-auto px-4">
    <div class="max-w-2xl mx-auto">
      <% flash.each do |type, message| %>
        <div class="mb-6 p-4 rounded-lg border <%= type.to_s == "alert" ? "border-red-500 bg-red-900/40" : "border-green-400 bg-green-900/30" %>">
          <p class="font-semibold"><%= message %></p>
        </div>
      <% end %>
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">
          <span data-i18n="payment_title"><%= t('payment_title', default: 'Secure Payment') %></span>
        </h1>
        <p class="text-xl text-gray-300">
          <span data-i18n="payment_subtitle"><%= t('payment_subtitle', default: 'Fast, secure payments powered by Stripe') %></span>
        </p>
      </div>

      <!-- Payment Form -->
      <div class="bg-gray-800 rounded-2xl p-8 border border-gray-700">
        <% if stripe_publishable_key.present? %>
          <input type="hidden" id="stripe-publishable-key" value="<%= stripe_publishable_key %>">
        <% end %>
        <%= form_with url: checkout_path, method: :post, class: "space-y-6", local: true do |f| %>
          <!-- Service Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
              <span data-i18n="payment_service_type"><%= t('payment_service_type', default: 'Service Type') %></span>
            </label>
            <select name="service_type" required class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:border-yellow-400 focus:outline-none">
              <option value="legal_documents"><%= t('service_legal_title', default: 'Legal Document Delivery') %></option>
              <option value="ecommerce"><%= t('service_ecommerce_title', default: 'E-commerce Delivery') %></option>
              <option value="express"><%= t('service_express', default: 'Express Delivery') %></option>
              <option value="standard"><%= t('service_standard', default: 'Standard Delivery') %></option>
            </select>
          </div>

          <!-- Amount -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
              <span data-i18n="payment_amount"><%= t('payment_amount', default: 'Amount (USD)') %></span>
            </label>
            <input type="number" name="amount" step="0.01" min="1" required 
                   class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:border-yellow-400 focus:outline-none"
                   placeholder="50.00">
          </div>

          <!-- Customer Information -->
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                <span data-i18n="payment_name"><%= t('payment_name', default: 'Full Name') %></span>
              </label>
              <input type="text" name="name" required 
                     class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:border-yellow-400 focus:outline-none"
                     placeholder="John Doe">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                <span data-i18n="payment_email"><%= t('payment_email', default: 'Email') %></span>
              </label>
              <input type="email" name="email" required 
                     class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:border-yellow-400 focus:outline-none"
                     placeholder="john@example.com">
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
              <span data-i18n="payment_phone"><%= t('payment_phone', default: 'Phone Number') %></span>
            </label>
            <input type="tel" name="phone" required 
                   class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:border-yellow-400 focus:outline-none"
                   placeholder="+1 (555) 000-0000">
          </div>

          <!-- Service Description (optional) -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
              <span data-i18n="payment_description"><%= t('payment_description', default: 'Service Description (Optional)') %></span>
            </label>
            <textarea name="service_description" rows="3" 
                      class="w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white focus:border-yellow-400 focus:outline-none"
                      placeholder="Enter delivery details..."></textarea>
          </div>

          <!-- Security Notice -->
          <div class="flex items-start space-x-3 bg-gray-900 p-4 rounded-lg border border-gray-700">
            <svg class="w-6 h-6 text-green-400 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
            <div class="text-sm text-gray-300">
              <p class="font-medium text-white mb-1">
                <span data-i18n="payment_secure_title"><%= t('payment_secure_title', default: 'Secure Payment') %></span>
              </p>
              <p>
                <span data-i18n="payment_secure_text"><%= t('payment_secure_text', default: 'Your payment information is encrypted and securely processed by Stripe. We never store your card details.') %></span>
              </p>
            </div>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="w-full bg-yellow-400 text-black font-bold py-4 px-6 rounded-lg hover:bg-yellow-500 transition-all transform hover:scale-105 shadow-lg text-lg flex items-center justify-center space-x-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
            </svg>
            <span data-i18n="payment_proceed"><%= t('payment_proceed', default: 'Proceed to Secure Payment') %></span>
            <% if stripe_publishable_key.blank? %>
              <span class="ml-2 text-sm text-red-300" data-testid="stripe-missing-token">(Stripe key missing)</span>
            <% end %>
          </button>

          <!-- Stripe Badge -->
          <div class="text-center text-sm text-gray-400">
            <span data-i18n="payment_powered_by"><%= t('payment_powered_by', default: 'Powered by') %></span>
            <span class="font-semibold text-white">Stripe</span>
          </div>
        <% end %>
      </div>

      <!-- Payment Methods -->
      <div class="mt-8 text-center">
        <p class="text-gray-400 mb-4">
          <span data-i18n="payment_methods_accepted"><%= t('payment_methods_accepted', default: 'Accepted Payment Methods') %></span>
        </p>
        <div class="flex justify-center space-x-4">
          <!-- Card Icons -->
          <div class="bg-gray-800 rounded-lg p-3 border border-gray-700">
            <svg class="w-12 h-8" fill="currentColor" viewBox="0 0 48 32">
              <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="text-yellow-400 font-bold text-sm">VISA</text>
            </svg>
          </div>
          <div class="bg-gray-800 rounded-lg p-3 border border-gray-700">
            <svg class="w-12 h-8" fill="currentColor" viewBox="0 0 48 32">
              <circle cx="16" cy="16" r="8" class="text-red-500" opacity="0.7"/>
              <circle cx="32" cy="16" r="8" class="text-yellow-400" opacity="0.7"/>
            </svg>
          </div>
          <div class="bg-gray-800 rounded-lg p-3 border border-gray-700">
            <svg class="w-12 h-8" fill="currentColor" viewBox="0 0 48 32">
              <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" class="text-blue-400 font-bold text-xs">AMEX</text>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
