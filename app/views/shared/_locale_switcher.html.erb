<!-- Locale Switcher Component -->
<% locales = [
  { code: :en, short: "EN", native: "English" },
  { code: :he, short: "HE", native: "עברית" },
  { code: :ar, short: "AR", native: "العربية" },
  { code: :ru, short: "RU", native: "Русский" }
] %>

<div class="locale-switcher relative inline-block" data-controller="locale-switcher"
     data-action="mouseenter->locale-switcher#open mouseleave->locale-switcher#close focusin->locale-switcher#open focusout->locale-switcher#handleFocusOut"
     data-testid="locale-switcher">
  <button type="button"
          class="locale-switcher__button flex items-center justify-center gap-2 rounded-full border-2 border-yellow-400 bg-black/40 px-4 py-2 text-sm font-semibold text-yellow-400 transition-all duration-300 hover:bg-yellow-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-400"
          data-locale-switcher-target="button"
          data-action="click->locale-switcher#toggle"
          aria-haspopup="true" aria-expanded="false">
    <span><%= I18n.locale.to_s.upcase %></span>
    <svg class="locale-switcher__icon h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>

  <div class="locale-switcher__menu absolute <%= rtl? ? 'left-0' : 'right-0' %> top-full mt-2 w-48 rounded-xl border border-gray-700 bg-black/95 backdrop-blur-md text-sm shadow-xl z-50"
       data-locale-switcher-target="menu" role="menu">
    <div class="py-2">
      <% locales.each do |locale| %>
        <% active = I18n.locale == locale[:code] %>
        <% link_classes = [
            "flex items-center gap-3 px-4 py-2 transition-all",
            active ? "bg-yellow-400/10 text-yellow-200" : "text-white hover:bg-yellow-400/10"
          ].join(' ') %>
        <%= link_to switch_locale_path(locale[:code]), class: link_classes, role: "menuitem" do %>
          <span class="text-xs font-bold text-yellow-400"><%= locale[:short] %></span>
          <span class="flex-1 text-sm"><%= locale[:native] %></span>
          <% if active %>
            <span class="text-yellow-400 text-sm">✓</span>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
