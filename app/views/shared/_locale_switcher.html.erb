<!-- Locale Switcher Component -->
<% locales = [
  { code: :en, short: "EN", native: "English" },
  { code: :he, short: "HE", native: "עברית" },
  { code: :ar, short: "AR", native: "العربية" },
  { code: :ru, short: "RU", native: "Русский" }
] %>

<div class="locale-switcher relative inline-flex items-center"
  data-controller="locale-switcher"
  data-locale-switcher-delay-value="220"
  data-action="mouseenter->locale-switcher#openFromHover mouseleave->locale-switcher#scheduleClose focusin->locale-switcher#openFromFocus"
  data-locale-switcher-ready="false"
  data-testid="locale-switcher">
  <button type="button"
      class="locale-switcher__button topbar-icon-button text-sm font-semibold focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-400/50"
          data-locale-switcher-target="button"
          data-action="click->locale-switcher#toggle mouseenter->locale-switcher#openFromHover"
          aria-haspopup="true" aria-expanded="false"
          aria-label="Language">
    <span class="text-sm font-bold text-black"><%= I18n.locale.to_s.upcase %></span>
  </button>

  <div class="locale-switcher__menu absolute <%= rtl? ? 'left-0' : 'right-0' %> top-full mt-2 sm:mt-3 w-44 sm:w-48 rounded-3xl bg-zinc-950/95 ring-1 ring-white/10 shadow-[0_30px_55px_rgba(0,0,0,0.7)] z-50"
       data-locale-switcher-target="menu" role="menu"
       data-action="mouseenter->locale-switcher#cancelClose mouseleave->locale-switcher#scheduleClose">
    <div class="py-3 px-2.5">
      <% locales.each do |locale| %>
        <% active = I18n.locale == locale[:code] %>
        <% link_classes = [
            "flex items-center gap-2 px-3.5 py-1.5 text-[11px] leading-tight rounded-xl transition-all",
            active ? "bg-yellow-400/15 text-yellow-100 shadow-inner shadow-yellow-400/15" : "text-white/90 hover:bg-yellow-400/5"
          ].join(' ') %>
        <%= link_to switch_locale_path(locale[:code]), class: link_classes, role: "menuitem" do %>
          <span class="text-[11px] font-bold text-yellow-300 tracking-wide"><%= locale[:short] %></span>
          <span class="flex-1 text-[11px] font-medium text-white"><%= locale[:native] %></span>
          <% if active %>
            <span class="text-yellow-300 text-sm">✓</span>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
