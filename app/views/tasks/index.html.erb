<% content_for :page_title, (@customer ? "Tasks for #{@customer.name}" : "All Tasks - Fastepost") %>

<div class="space-y-6">
  <%= turbo_stream_from "tasks" %>

  <div class="flex items-start justify-between gap-4">
    <div>
      <nav class="flex items-center text-sm text-slate-300 flex-wrap gap-1" aria-label="Breadcrumb">
        <%= link_to root_path, class: "hover:text-white transition-colors" do %>
          <span class="inline-flex items-center">
            <span class="material-icons mr-1 text-sm">home</span>
            <%= t("nav.home", default: "Home") %>
          </span>
        <% end %>
        <% if @customer %>
          <span class="material-icons text-sm text-slate-500 mx-1">chevron_right</span>
          <%= link_to t("customers.title", default: "Customers"), customers_path, class: "hover:text-white transition-colors" %>
          <span class="material-icons text-sm text-slate-500 mx-1">chevron_right</span>
          <%= link_to @customer.name, customer_path(@customer), class: "hover:text-white transition-colors" %>
        <% end %>
        <span class="material-icons text-sm text-slate-500 mx-1">chevron_right</span>
        <span class="text-white font-medium"><%= t("tasks.title", default: "Tasks") %></span>
      </nav>

      <h1 class="mt-3 text-3xl font-bold text-white">
        <% if @customer %>
          <%= t("tasks.for_customer", customer: @customer.name, default: "Tasks for %{customer}") %>
        <% else %>
          <%= t("tasks.all", default: "All Tasks") %>
        <% end %>
      </h1>
    </div>

    <%= link_to (@customer ? new_customer_task_path(@customer) : new_task_path),
      class: "inline-flex items-center justify-center rounded-xl bg-yellow-400 px-6 py-3 text-sm font-semibold text-black shadow-lg shadow-yellow-500/20 hover:bg-yellow-300" do %>
      <span class="material-icons <%= margin_end_class('2') %> text-xl">add</span>
      <%= t('tasks.new') %>
    <% end %>
  </div>

  <div class="rounded-2xl border border-white/10 bg-white/5 px-5 pt-6 pb-2.5 shadow-xl shadow-black/30 backdrop-blur">
    <div class="mb-6 flex items-center justify-between">
      <h2 class="text-xl font-semibold text-white">
        <%= t('tasks.title') %> <%= t("tasks.for_customer_short", customer: @customer.name, default: "for %{customer}") if @customer %>
      </h2>
    </div>

    <%= turbo_frame_tag "tasks_table" do %>
      <div class="max-w-full overflow-x-auto">
        <table class="w-full table-auto">
          <thead>
            <tr class="bg-white/5 text-left border-b border-white/10">
              <th class="min-w-[160px] px-4 py-4 font-semibold text-slate-200 text-center"><%= t("tasks.table.reference", default: "Reference") %></th>
              <th class="min-w-[140px] px-4 py-4 font-semibold text-slate-200 text-center"><%= t("tasks.table.status", default: "Status") %></th>
              <th class="min-w-[120px] px-4 py-4 font-semibold text-slate-200 text-center"><%= t("tasks.table.priority", default: "Priority") %></th>
              <th class="min-w-[180px] px-4 py-4 font-semibold text-slate-200 text-center"><%= t("tasks.table.customer", default: "Customer") %></th>
              <th class="min-w-[120px] px-4 py-4 font-semibold text-slate-200 text-center"><%= t("tasks.table.carrier", default: "Carrier") %></th>
              <th class="min-w-[160px] px-4 py-4 font-semibold text-slate-200 text-center"><%= t("tasks.table.created", default: "Created") %></th>
              <th class="px-4 py-4 font-semibold text-slate-200 text-center"><%= t("tasks.table.actions", default: "Actions") %></th>
            </tr>
          </thead>
          <tbody id="tasks_list">
            <%= render partial: "tasks/task_card", collection: @tasks, as: :task %>
          </tbody>
        </table>
        
        <% if @tasks.empty? %>
          <div class="px-6 py-10 text-center">
            <span class="material-icons text-slate-400 text-5xl mb-3">inbox</span>
            <h3 class="text-base font-semibold text-white mb-1"><%= t('tasks.no_tasks') %></h3>
            <p class="text-sm text-slate-300"><%= t("tasks.empty_hint", default: "Get started by creating a new task.") %></p>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

</div>
