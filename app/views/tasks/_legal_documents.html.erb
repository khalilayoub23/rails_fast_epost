<% align_class = rtl? ? "text-right" : "text-left" %>
<% row_class = rtl? ? "flex-row-reverse" : "" %>
<div class="hidden"
  data-task-type-form-target="section"
  data-task-types="court_filings,process_serving,notarization_and_apostille,criminal_file_photocopying,traffic_file_photocopying,enforcement_office_services,bailiff_services_coordination,land_registry_tabu_services,companies_registrar_services,filing_to_arbitration_mediation_centers,proof_of_delivery_pod">
  <h3 class="text-xl font-semibold text-white"><%= t("tasks.legal_documents_title", default: "Legal Documents") %></h3>

  <div class="rounded-xl border border-white/10 bg-white/5 p-6 <%= align_class %>">
    <div class="mt-12 space-y-12">
    <div>
      <%= f.label :legal_files, t("tasks.legal_files", default: "Upload Files (PDF, Images)"), class: "mb-2 block text-lg font-semibold text-slate-200" %>
      <%= f.file_field :legal_files,
        multiple: true,
        accept: "application/pdf,image/*",
        class: "block w-full rounded-lg border border-white/10 bg-white/5 px-4 py-3 text-base text-slate-200 file:mr-4 file:rounded-lg file:border-0 file:bg-yellow-400 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-black hover:file:bg-yellow-300" %>
    </div>

        <div class="hidden rounded-lg border border-white/10 bg-white/5 p-4 mt-12"
          data-controller="poa-toggle"
          data-task-type-form-target="section"
          data-task-types="criminal_file_photocopying,traffic_file_photocopying,document_retrieval_from_government_agencies,court_filings,process_serving,filing_to_arbitration_mediation_centers,notarization_and_apostille">
      <div class="flex items-center justify-between gap-3 <%= row_class %>">
        <div class="flex items-center gap-3 <%= rtl? ? 'flex-row-reverse text-right' : '' %>">
          <span class="text-sm font-semibold text-slate-200"><%= t("tasks.power_of_attorney", default: "Power of Attorney") %></span>
        </div>
        <div class="flex items-center gap-3 <%= rtl? ? 'flex-row-reverse' : '' %>">
          <span class="inline-flex items-center rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs font-semibold text-slate-300" data-poa-toggle-target="status"></span>
          <label class="relative inline-flex items-center cursor-pointer">
            <span class="sr-only"><%= t("tasks.power_of_attorney", default: "Power of Attorney (signed)") %></span>
            <%= check_box_tag "poa_enabled", "1",
              Task::POA_MANDATORY_TASK_TYPES.include?(task.task_type),
                  class: "sr-only",
                  data: { poa_toggle_target: "toggle", action: "change->poa-toggle#toggle" } %>
            <span class="h-6 w-11 rounded-full border border-white/10 bg-white/5 shadow-inner transition-colors"></span>
            <span class="pointer-events-none absolute h-5 w-5 rounded-full bg-yellow-400 shadow translate-x-1 transition-transform"></span>
          </label>
        </div>
      </div>
      <%= f.hidden_field :poa_enabled, value: "0", data: { poa_toggle_target: "enabled" } %>
      <%= f.hidden_field :poa_document_template_id,
        value: @poa_templates&.first&.id,
        data: { poa_toggle_target: "select" } %>
    </div>

    <% if task.persisted? && task.legal_files.attached? %>
      <div class="space-y-2">
        <p class="text-sm font-semibold text-slate-200"><%= t("tasks.attached_files", default: "Attached Files:") %></p>
        <% task.legal_files.each do |file| %>
          <div class="flex items-center justify-between gap-3 rounded-lg border border-white/10 bg-white/5 p-3 <%= row_class %>">
            <div class="flex items-center gap-3 <%= row_class %>">
              <svg class="h-5 w-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              <span class="text-sm text-white"><%= file.filename %></span>
              <span class="text-xs text-slate-400">(<%= number_to_human_size(file.byte_size) %>)</span>
            </div>
            <% if file.persisted? && file.blob&.persisted? %>
              <%= link_to t("tasks.view_file", default: "View"), rails_blob_path(file, disposition: "inline"),
                    target: "_blank",
                    class: "inline-flex items-center rounded-lg bg-yellow-400 px-3 py-1 text-xs font-semibold text-black hover:bg-yellow-300" %>
            <% else %>
              <span class="inline-flex items-center rounded-lg bg-white/10 px-3 py-1 text-xs font-semibold text-slate-300"><%= t("tasks.pending_upload", default: "Pending upload") %></span>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
