<% currency_unit = "USD" %>
<section class="space-y-8">
  <div class="grid gap-4 md:grid-cols-4">
    <%= render "control_panel/shared/stat_card",
          label: "Outstanding payouts",
          value: number_to_currency(@payout_metrics[:outstanding_amount_cents] / 100.0, unit: currency_unit),
          subtitle: "#{@payout_metrics[:outstanding_count]} tasks awaiting payment",
          container_class: "rounded-2xl border border-white/10 bg-white/5 backdrop-blur p-4",
          label_class: "text-xs uppercase tracking-wide text-slate-400",
          value_class: "mt-2 text-3xl font-semibold text-yellow-300",
          subtitle_class: "text-sm text-slate-400" %>
    <%= render "control_panel/shared/stat_card",
          label: "Cleared payouts",
          value: number_to_currency(@payout_metrics[:cleared_amount_cents] / 100.0, unit: currency_unit),
          subtitle: "#{@payout_metrics[:cleared_count]} payouts completed",
          container_class: "rounded-2xl border border-white/10 bg-white/5 backdrop-blur p-4",
          label_class: "text-xs uppercase tracking-wide text-slate-400",
          value_class: "mt-2 text-3xl font-semibold text-emerald-300",
          subtitle_class: "text-sm text-slate-400" %>
    <%= render "control_panel/shared/stat_card",
          label: "Next payout date",
          value: (@payout_metrics[:next_due_at].present? ? l(@payout_metrics[:next_due_at], format: :long) : "TBD"),
          subtitle: "Earliest due payout",
          container_class: "rounded-2xl border border-white/10 bg-white/5 backdrop-blur p-4",
          label_class: "text-xs uppercase tracking-wide text-slate-400",
          value_class: "mt-2 text-3xl font-semibold #{@payout_metrics[:next_due_at].present? ? 'text-white' : 'text-slate-500'}",
          subtitle_class: "text-sm text-slate-400" %>
    <%= render "control_panel/shared/stat_card",
          label: "Recent payouts",
          value: (@recent_payouts.first ? number_to_currency(@recent_payouts.first.amount_cents / 100.0, unit: currency_unit) : "No payouts"),
          subtitle: (@recent_payouts.first ? "Task #{@recent_payouts.first.task&.barcode}" : "No payout data yet."),
          container_class: "rounded-2xl border border-white/10 bg-white/5 backdrop-blur p-4",
          label_class: "text-xs uppercase tracking-wide text-slate-400",
          value_class: "mt-2 text-3xl font-semibold text-slate-200",
          subtitle_class: "text-sm text-slate-400" %>
  </div>

  <%= render "task_board", board_columns: @board_columns %>

  <div class="grid gap-4 lg:grid-cols-2">
    <%= render "event_log", events: @events %>
    <%= render "payout_detail_table", recent_payouts: @recent_payouts %>
  </div>
</section>
