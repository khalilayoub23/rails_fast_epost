<% content_for :control_panel_context do %>
  <div class="rounded-2xl border border-white/10 bg-gradient-to-r from-slate-900/80 to-indigo-900/60 p-6 shadow-2xl shadow-black/40">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <p class="text-xs uppercase tracking-[0.4em] text-slate-300/80">Operations</p>
        <h1 class="text-3xl font-semibold text-white">Network Health Overview</h1>
      </div>
      <div class="rounded-xl border border-white/20 bg-white/5 px-4 py-2 text-sm text-slate-200">
        <span class="font-semibold"><%= Time.current.strftime('%b %d, %Y %H:%M') %></span>
        <span class="ml-2 text-slate-400">Auto-refresh via Turbo Streams</span>
      </div>
    </div>
    <p class="mt-4 max-w-3xl text-sm text-slate-200/90">
      Monitor carrier payouts, delivery incidents, and SLA risk in a single control room. Use this view to unblock stalled shipments before they hit customers.
    </p>
  </div>
<% end %>

<% currency = "USD" %>
<div class="grid gap-4 md:grid-cols-2 xl:grid-cols-3">
  <%= render "control_panel/shared/stat_card",
        label: "Active Tasks",
        value: @kpis[:active_tasks],
        subtitle: "Pending / In transit shipments" %>
  <%= render "control_panel/shared/stat_card",
        label: "At Risk",
        value: @kpis[:delayed_tasks],
        subtitle: "In-transit past SLA (12h)",
        container_class: "rounded-2xl border border-rose-500/30 bg-rose-500/10 backdrop-blur p-5",
        label_class: "text-xs font-semibold uppercase tracking-wide text-rose-200",
        value_class: "mt-2 text-4xl font-bold text-rose-100",
        subtitle_class: "text-sm text-rose-200/70" %>
  <%= render "control_panel/shared/stat_card",
        label: "Failed / Investigations",
        value: @kpis[:failed_tasks],
        subtitle: "Awaiting remediation",
        container_class: "rounded-2xl border border-amber-400/30 bg-amber-400/10 backdrop-blur p-5",
        label_class: "text-xs font-semibold uppercase tracking-wide text-amber-200",
        value_class: "mt-2 text-4xl font-bold text-amber-100",
        subtitle_class: "text-sm text-amber-200/70" %>
  <%= render "control_panel/shared/stat_card",
        label: "Outstanding carrier payouts",
        value: number_to_currency(@kpis[:outstanding_payouts_cents].to_i / 100.0, unit: currency),
        subtitle: "Scheduled + pending carrier disbursements",
        container_class: "rounded-2xl border border-emerald-400/30 bg-emerald-500/10 backdrop-blur p-5",
        label_class: "text-xs font-semibold uppercase tracking-wide text-emerald-200",
        value_class: "mt-2 text-3xl font-bold text-emerald-100",
        subtitle_class: "text-sm text-emerald-200/70" %>
  <%= render "control_panel/shared/stat_card",
        label: "Active Carriers",
        value: @kpis[:carriers_online],
        subtitle: "Connected carrier partners" %>
  <%= render "control_panel/shared/stat_card",
        label: "Active Senders",
        value: @kpis[:active_senders],
        subtitle: "Shippers with activity this quarter" %>
</div>

<div class="grid gap-6 lg:grid-cols-2 mt-6">
  <%= render "carrier_performance", carrier_leaderboard: @carrier_leaderboard %>
  <%= render "payout_alerts", payout_alerts: @payout_alerts, currency: currency %>
</div>

<div class="grid gap-6 lg:grid-cols-2 mt-6">
  <%= render "late_shipments", late_tasks: @late_tasks %>
  <%= render "incident_feed", incident_feed: @incident_feed %>
</div>
