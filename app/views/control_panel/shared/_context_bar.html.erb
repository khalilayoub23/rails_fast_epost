<% panel_title = @control_panel_title.presence || (content_for?(:page_title) ? yield(:page_title) : "Control Panel") %>

<div class="rounded-2xl border border-white/10 bg-white/5 p-5 shadow-lg shadow-black/40 backdrop-blur">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <div>
      <p class="text-xs uppercase tracking-[0.3em] text-slate-300/80">Control Panel</p>
      <h1 class="text-2xl font-semibold text-white"><%= panel_title %></h1>
    </div>

    <div class="flex flex-wrap items-center gap-4 text-sm">
      <% if current_user&.carriers&.many? %>
        <%= form_with url: request.path, method: :get, local: true, class: "flex flex-wrap items-center gap-2" do %>
          <% request.query_parameters.except("carrier_id").each do |key, value| %>
            <%= hidden_field_tag key, value %>
          <% end %>
          <label class="text-xs font-semibold uppercase tracking-wide text-slate-300" for="carrier_id">Carrier</label>
          <select name="carrier_id" id="carrier_id" class="rounded-xl border border-white/20 bg-white/10 px-3 py-2 text-sm text-white shadow-inner focus:border-yellow-300 focus:outline-none">
            <% current_user.carriers.each do |carrier| %>
              <option value="<%= carrier.id %>" <%= "selected" if carrier == current_carrier_context %>><%= carrier.name %></option>
            <% end %>
          </select>
          <button type="submit" class="inline-flex items-center rounded-xl bg-yellow-400 px-4 py-2 font-semibold text-gray-900 shadow-lg shadow-yellow-500/30 transition hover:-translate-y-0.5 hover:bg-yellow-300">
            Switch
          </button>
        <% end %>
      <% elsif current_carrier_context %>
        <div class="rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-slate-200 shadow-inner">
          <span class="text-xs uppercase tracking-wide text-slate-400">Carrier</span>
          <p class="font-semibold"><%= current_carrier_context.name %></p>
        </div>
      <% end %>
    </div>
  </div>

  <p class="mt-4 text-sm text-slate-300/90">
    Carrier payouts shown below reflect compensation owed to your organization and exclude what senders paid during checkout.
  </p>
</div>
